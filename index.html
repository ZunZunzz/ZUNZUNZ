<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>School RFID Attendance V4</title>

<style>
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    max-width: 900px;
    margin: 2rem auto;
    padding: 0 1rem;
    background-color: #f0f2f5;
}
.container {
    background: white;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    margin-bottom: 20px;
}
h1, h2 { text-align: center; color: #2c3e50; }

input, select {
    width: 100%;
    padding: 12px;
    margin: 5px 0;
    border: 2px solid #e1e4e8;
    border-radius: 6px;
    font-size: 16px;
}
input:focus, select:focus { border-color: #4CAF50; outline: none; }

button {
    width: 100%;
    padding: 14px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
}
button:hover { background-color: #45a049; }

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}
th, td {
    padding: 12px;
    border-bottom: 1px solid #eee;
}
th { background: #4CAF50; color: white; }

.profile-pic {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    object-fit: cover;
}
.no-pic {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background: #eee;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #999;
}

.admin-box {
    border: 2px dashed #cbd5e0;
    background: #f8fafc;
}
.form-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
}
@media (max-width: 600px) {
    .form-grid { grid-template-columns: 1fr; }
}
.counter-box {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin: 15px 0;
}
.counter {
    padding: 10px 18px;
    border-radius: 10px;
    font-weight: bold;
}
.male { background: #e3f2fd; color: #1565c0; }
.female { background: #fce4ec; color: #ad1457; }
</style>
</head>

<body>

<div class="container">
<h1>üè´ Daily Attendance Check-in</h1>
<p style="text-align:center;">Click below and scan your card</p>

<input type="text" id="attendanceInput" placeholder="Scan RFID tag..." autofocus>

<div class="counter-box">
    <div id="maleCount" class="counter male">üë¶ Male: 0</div>
    <div id="femaleCount" class="counter female">üëß Female: 0</div>
</div>

<table id="attendanceTable">
<thead>
<tr>
    <th>Photo</th>
    <th>Time</th>
    <th>Name</th>
    <th>Grade</th>
    <th>Gender</th>
    <th>ID</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<div class="container admin-box">
<h2>‚ûï Register Student</h2>

<div class="form-grid">
    <input id="regName" placeholder="Full Name">
    <select id="regGrade">
        <option disabled selected>Grade</option>
        <option>Grade 1</option><option>Grade 2</option><option>Grade 3</option>
        <option>Grade 4</option><option>Grade 5</option><option>Grade 6</option>
        <option>Teacher</option>
    </select>
    <select id="regGender">
        <option disabled selected>Gender</option>
        <option>Male</option>
        <option>Female</option>
        <option>Other</option>
    </select>
</div>

<input type="file" id="regPhoto" accept="image/*">
<input id="regTag" placeholder="Scan card to register">

<button onclick="registerStudent()">Save Student</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
    getFirestore, collection, addDoc, setDoc, doc,
    onSnapshot, query, orderBy, where, serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyApplG-C0kfS2TtdzUbmew9KQK59pT8XbM",
  authDomain: "my-rfid-attendance.firebaseapp.com",
  projectId: "my-rfid-attendance",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const toBase64 = file => new Promise(r => {
    const reader = new FileReader();
    reader.onload = () => r(reader.result);
    reader.readAsDataURL(file);
});

let students = {};

onSnapshot(collection(db, "students"), snap => {
    snap.forEach(d => students[d.id] = d.data());
});

window.registerStudent = async () => {
    const name = regName.value.trim();
    const grade = regGrade.value;
    const gender = regGender.value;
    const tag = regTag.value.trim();
    const photoFile = regPhoto.files[0];

    if (!name || !grade || !gender || !tag) return alert("Fill all fields");

    let photo = photoFile ? await toBase64(photoFile) : null;

    await setDoc(doc(db, "students", tag), {
        name, grade, gender, photo, registeredAt: serverTimestamp()
    });

    alert("Student registered");
    regName.value = regTag.value = "";
};

attendanceInput.addEventListener("keypress", async e => {
    if (e.key === "Enter") {
        const id = attendanceInput.value.trim();
        if (!id) return;
        const s = students[id];

        await addDoc(collection(db, "attendance"), {
            tag_id: id,
            student_name: s?.name || "Unknown",
            student_grade: s?.grade || "N/A",
            student_gender: s?.gender || "N/A",
            student_photo: s?.photo || null,
            timestamp: serverTimestamp()
        });

        attendanceInput.value = "";
    }
});

const start = new Date(); start.setHours(0,0,0,0);
const end = new Date(); end.setHours(23,59,59,999);

const q = query(
    collection(db, "attendance"),
    where("timestamp", ">=", start),
    where("timestamp", "<=", end),
    orderBy("timestamp", "desc")
);

onSnapshot(q, snap => {
    let male = 0, female = 0;
    attendanceTable.querySelector("tbody").innerHTML = "";

    snap.forEach(d => {
        const a = d.data();
        if (a.student_gender === "Male") male++;
        if (a.student_gender === "Female") female++;

        attendanceTable.querySelector("tbody").innerHTML += `
        <tr>
            <td>${a.student_photo ? `<img src="${a.student_photo}" class="profile-pic">` : `<div class="no-pic">?</div>`}</td>
            <td>${a.timestamp?.toDate().toLocaleTimeString()}</td>
            <td>${a.student_name}</td>
            <td>${a.student_grade}</td>
            <td>${a.student_gender}</td>
            <td>${a.tag_id}</td>
        </tr>`;
    });

    maleCount.textContent = `üë¶ Male: ${male}`;
    femaleCount.textContent = `üëß Female: ${female}`;
});
</script>

</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>School RFID Attendance V4</title>

<style>
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    max-width: 900px;
    margin: 2rem auto;
    padding: 0 1rem;
    background-color: #f0f2f5;
}
.container {
    background: white;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    margin-bottom: 20px;
}
h1, h2 { text-align: center; color: #2c3e50; }

input, select {
    width: 100%;
    padding: 12px;
    margin: 5px 0;
    border: 2px solid #e1e4e8;
    border-radius: 6px;
    font-size: 16px;
}
input:focus, select:focus { border-color: #4CAF50; outline: none; }

button {
    width: 100%;
    padding: 14px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
}
button:hover { background-color: #45a049; }

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}
th, td {
    padding: 12px;
    border-bottom: 1px solid #eee;
}
th { background: #4CAF50; color: white; }

.profile-pic {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    object-fit: cover;
}
.no-pic {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background: #eee;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #999;
}

.admin-box {
    border: 2px dashed #cbd5e0;
    background: #f8fafc;
}
.form-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
}
@media (max-width: 600px) {
    .form-grid { grid-template-columns: 1fr; }
}
.counter-box {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin: 15px 0;
}
.counter {
    padding: 10px 18px;
    border-radius: 10px;
    font-weight: bold;
}
.male { background: #e3f2fd; color: #1565c0; }
.female { background: #fce4ec; color: #ad1457; }
</style>
</head>

<body>

<div class="container">
<h1>üè´ Daily Attendance Check-in</h1>
<p style="text-align:center;">Click below and scan your card</p>

<input type="text" id="attendanceInput" placeholder="Scan RFID tag..." autofocus>

<div class="counter-box">
    <div id="maleCount" class="counter male">üë¶ Male: 0</div>
    <div id="femaleCount" class="counter female">üëß Female: 0</div>
</div>

<table id="attendanceTable">
<thead>
<tr>
    <th>Photo</th>
    <th>Time</th>
    <th>Name</th>
    <th>Grade</th>
    <th>Gender</th>
    <th>ID</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<div class="container admin-box">
<h2>‚ûï Register Student</h2>

<div class="form-grid">
    <input id="regName" placeholder="Full Name">
    <select id="regGrade">
        <option disabled selected>Grade</option>
        <option>Grade 1</option><option>Grade 2</option><option>Grade 3</option>
        <option>Grade 4</option><option>Grade 5</option><option>Grade 6</option>
        <option>Teacher</option>
    </select>
    <select id="regGender">
        <option disabled selected>Gender</option>
        <option>Male</option>
        <option>Female</option>
        <option>Other</option>
    </select>
</div>

<input type="file" id="regPhoto" accept="image/*">
<input id="regTag" placeholder="Scan card to register">

<button onclick="registerStudent()">Save Student</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
    getFirestore, collection, addDoc, setDoc, doc,
    onSnapshot, query, orderBy, where, serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyApplG-C0kfS2TtdzUbmew9KQK59pT8XbM",
  authDomain: "my-rfid-attendance.firebaseapp.com",
  projectId: "my-rfid-attendance",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const toBase64 = file => new Promise(r => {
    const reader = new FileReader();
    reader.onload = () => r(reader.result);
    reader.readAsDataURL(file);
});

let students = {};

onSnapshot(collection(db, "students"), snap => {
    snap.forEach(d => students[d.id] = d.data());
});

window.registerStudent = async () => {
    const name = regName.value.trim();
    const grade = regGrade.value;
    const gender = regGender.value;
    const tag = regTag.value.trim();
    const photoFile = regPhoto.files[0];

    if (!name || !grade || !gender || !tag) return alert("Fill all fields");

    let photo = photoFile ? await toBase64(photoFile) : null;

    await setDoc(doc(db, "students", tag), {
        name, grade, gender, photo, registeredAt: serverTimestamp()
    });

    alert("Student registered");
    regName.value = regTag.value = "";
};

attendanceInput.addEventListener("keypress", async e => {
    if (e.key === "Enter") {
        const id = attendanceInput.value.trim();
        if (!id) return;
        const s = students[id];

        await addDoc(collection(db, "attendance"), {
            tag_id: id,
            student_name: s?.name || "Unknown",
            student_grade: s?.grade || "N/A",
            student_gender: s?.gender || "N/A",
            student_photo: s?.photo || null,
            timestamp: serverTimestamp()
        });

        attendanceInput.value = "";
    }
});

const start = new Date(); start.setHours(0,0,0,0);
const end = new Date(); end.setHours(23,59,59,999);

const q = query(
    collection(db, "attendance"),
    where("timestamp", ">=", start),
    where("timestamp", "<=", end),
    orderBy("timestamp", "desc")
);

onSnapshot(q, snap => {
    let male = 0, female = 0;
    attendanceTable.querySelector("tbody").innerHTML = "";

    snap.forEach(d => {
        const a = d.data();
        if (a.student_gender === "Male") male++;
        if (a.student_gender === "Female") female++;

        attendanceTable.querySelector("tbody").innerHTML += `
        <tr>
            <td>${a.student_photo ? `<img src="${a.student_photo}" class="profile-pic">` : `<div class="no-pic">?</div>`}</td>
            <td>${a.timestamp?.toDate().toLocaleTimeString()}</td>
            <td>${a.student_name}</td>
            <td>${a.student_grade}</td>
            <td>${a.student_gender}</td>
            <td>${a.tag_id}</td>
        </tr>`;
    });

    maleCount.textContent = `üë¶ Male: ${male}`;
    femaleCount.textContent = `üëß Female: ${female}`;
});
</script>

</body>
</html>

</html>

